<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG Pipeline Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .label-description {
            font-size: 0.85em;
            color: #777;
            font-weight: normal;
            margin-left: 5px;
        }

        select,
        input[type="text"],
        input[type="number"],
        input[type="file"],
        input[type="checkbox"] {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        select,
        input[type="text"],
        input[type="number"] {
            width: 100%;
        }

        input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
        }

        select:focus,
        input:focus {
            outline: none;
            border-color: #667eea;
        }

        .dynamic-params {
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .dynamic-params h3 {
            font-size: 1.1em;
            color: #667eea;
            margin-bottom: 15px;
        }

        .param-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 16px;
            font-weight: 600;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
            margin-top: 20px;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .progress-container {
            margin-top: 30px;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #777;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .empty-state {
            text-align: center;
            padding: 20px;
            color: #999;
            font-style: italic;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ RAG Pipeline Builder</h1>
            <p>–°–æ–∑–¥–∞–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –≤–∞—à –ø–∞–π–ø–ª–∞–π–Ω –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</p>
        </div>

        <div class="content">
            <!-- Pipeline Name -->
            <div class="section">
                <h2>üìù –ù–∞–∑–≤–∞–Ω–∏–µ –ø–∞–π–ø–ª–∞–π–Ω–∞</h2>
                <div class="form-group">
                    <label>–ò–º—è</label>
                    <input type="text" id="pipelineName" value="my_pipeline" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
                </div>
            </div>

            <!-- Loader -->
            <div class="section">
                <h2>üìÑ 1. –ó–∞–≥—Ä—É–∑—á–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</h2>
                <div class="form-group">
                    <label>–¢–∏–ø –∑–∞–≥—Ä—É–∑—á–∏–∫–∞</label>
                    <select id="loaderType" onchange="loadLoaderParams()">
                        <option value="">–ó–∞–≥—Ä—É–∑–∫–∞...</option>
                    </select>
                </div>
                <div id="loaderParams" class="dynamic-params" style="display: none;">
                    <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–≥—Ä—É–∑—á–∏–∫–∞</h3>
                    <div id="loaderParamsContent" class="param-grid"></div>
                </div>
            </div>

            <!-- Splitter -->
            <div class="section">
                <h2>‚úÇÔ∏è 2. –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å —Ç–µ–∫—Å—Ç–∞</h2>
                <div class="form-group">
                    <label>–¢–∏–ø —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è</label>
                    <select id="splitterType" onchange="loadSplitterParams()">
                        <option value="">–ó–∞–≥—Ä—É–∑–∫–∞...</option>
                    </select>
                </div>
                <div id="splitterParams" class="dynamic-params" style="display: none;">
                    <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è</h3>
                    <div id="splitterParamsContent" class="param-grid"></div>
                </div>
            </div>

            <!-- Embedding -->
            <div class="section">
                <h2>üß† 3. –ú–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤</h2>
                <div class="form-group">
                    <label>–¢–∏–ø —ç–º–±–µ–¥–¥–∏–Ω–≥–∞</label>
                    <select id="embeddingType" onchange="loadEmbeddingParams()">
                        <option value="">–ó–∞–≥—Ä—É–∑–∫–∞...</option>
                    </select>
                </div>
                <div id="embeddingParams" class="dynamic-params" style="display: none;">
                    <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —ç–º–±–µ–¥–¥–∏–Ω–≥–∞</h3>
                    <div id="embeddingParamsContent" class="param-grid"></div>
                </div>
            </div>

            <!-- Database -->
            <div class="section">
                <h2>üíæ 4. –í–µ–∫—Ç–æ—Ä–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</h2>
                <div class="form-group">
                    <label>–¢–∏–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</label>
                    <select id="databaseType" onchange="loadDatabaseParams()">
                        <option value="">–ó–∞–≥—Ä—É–∑–∫–∞...</option>
                    </select>
                </div>
                <div id="databaseParams" class="dynamic-params" style="display: none;">
                    <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</h3>
                    <div id="databaseParamsContent" class="param-grid"></div>
                </div>
            </div>

            <!-- File Upload -->
            <div class="section">
                <h2>üì§ 5. –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</h2>
                <div class="form-group">
                    <label>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏</label>
                    <input type="file" id="fileInput" accept=".pdf,.txt,.md">
                    <div id="fileInfo" class="file-info" style="display: none;"></div>
                </div>
                <button id="processBtn" onclick="processPipeline()">
                    –°–æ–∑–¥–∞—Ç—å –ø–∞–π–ø–ª–∞–π–Ω –∏ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ñ–∞–π–ª
                </button>
            </div>

            <!-- Progress -->
            <div class="progress-container" id="progressContainer">
                <h3>–û–±—Ä–∞–±–æ—Ç–∫–∞...</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill">0%</div>
                </div>
                <div id="statusMessage" class="status-message status-info"></div>
            </div>

            <!-- Results -->
            <div class="section" id="resultsSection" style="display: none;">
                <h2>‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
                <div class="stats" id="stats"></div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000';

        // Store component schemas
        let componentSchemas = {
            loaders: {},
            splitters: {},
            embeddings: {},
            databases: {}
        };

        // Store current parameter values
        let currentParams = {
            loader: {},
            splitter: {},
            embedding: {},
            database: {}
        };

        // Load components on page load
        window.onload = async () => {
            await loadLoaders();
            await loadSplitters();
            await loadEmbeddings();
            await loadDatabases();
        };

        // ==========================================
        // LOAD COMPONENT LISTS
        // ==========================================

        async function loadLoaders() {
            try {
                const response = await fetch(`${API_URL}/api/loaders`);
                const loaders = await response.json();
                const select = document.getElementById('loaderType');

                select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–≥—Ä—É–∑—á–∏–∫ --</option>' +
                    loaders.map(l => {
                        componentSchemas.loaders[l.id] = l.config_schema;
                        return `<option value="${l.id}">${l.name}</option>`;
                    }).join('');
            } catch (error) {
                console.error('Error loading loaders:', error);
                showStatus('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –∑–∞–≥—Ä—É–∑—á–∏–∫–æ–≤', 'error');
            }
        }

        async function loadSplitters() {
            try {
                const response = await fetch(`${API_URL}/api/splitters`);
                const splitters = await response.json();
                const select = document.getElementById('splitterType');

                select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å --</option>' +
                    splitters.map(s => {
                        componentSchemas.splitters[s.id] = s.config_schema;
                        return `<option value="${s.id}">${s.name}</option>`;
                    }).join('');
            } catch (error) {
                console.error('Error loading splitters:', error);
            }
        }

        async function loadEmbeddings() {
            try {
                const response = await fetch(`${API_URL}/api/embeddings`);
                const embeddings = await response.json();
                const select = document.getElementById('embeddingType');

                select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å --</option>' +
                    embeddings.map(e => {
                        componentSchemas.embeddings[e.id] = e.config_schema;
                        return `<option value="${e.id}">${e.name}</option>`;
                    }).join('');
            } catch (error) {
                console.error('Error loading embeddings:', error);
            }
        }

        async function loadDatabases() {
            try {
                const response = await fetch(`${API_URL}/api/databases`);
                const databases = await response.json();
                const select = document.getElementById('databaseType');

                select.innerHTML = '<option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö --</option>' +
                    databases.map(d => {
                        componentSchemas.databases[d.id] = d.config_schema;
                        return `<option value="${d.id}">${d.name}</option>`;
                    }).join('');
            } catch (error) {
                console.error('Error loading databases:', error);
            }
        }

        // ==========================================
        // DYNAMIC PARAMETER LOADING
        // ==========================================

        function loadLoaderParams() {
            const selectedType = document.getElementById('loaderType').value;
            if (!selectedType) {
                document.getElementById('loaderParams').style.display = 'none';
                return;
            }

            const schema = componentSchemas.loaders[selectedType];
            renderParams('loader', schema, 'loaderParamsContent');
            document.getElementById('loaderParams').style.display = 'block';
        }

        function loadSplitterParams() {
            const selectedType = document.getElementById('splitterType').value;
            if (!selectedType) {
                document.getElementById('splitterParams').style.display = 'none';
                return;
            }

            const schema = componentSchemas.splitters[selectedType];
            renderParams('splitter', schema, 'splitterParamsContent');
            document.getElementById('splitterParams').style.display = 'block';
        }

        function loadEmbeddingParams() {
            const selectedType = document.getElementById('embeddingType').value;
            if (!selectedType) {
                document.getElementById('embeddingParams').style.display = 'none';
                return;
            }

            const schema = componentSchemas.embeddings[selectedType];
            renderParams('embedding', schema, 'embeddingParamsContent');
            document.getElementById('embeddingParams').style.display = 'block';
        }

        function loadDatabaseParams() {
            const selectedType = document.getElementById('databaseType').value;
            if (!selectedType) {
                document.getElementById('databaseParams').style.display = 'none';
                return;
            }

            const schema = componentSchemas.databases[selectedType];
            renderParams('database', schema, 'databaseParamsContent');
            document.getElementById('databaseParams').style.display = 'block';
        }

        // ==========================================
        // RENDER PARAMETERS DYNAMICALLY
        // ==========================================

        function renderParams(componentType, schema, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            if (!schema || !schema.properties) {
                container.innerHTML = '<div class="empty-state">–ù–µ—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</div>';
                return;
            }

            const properties = schema.properties;

            // Skip 'type' field as it's already selected
            Object.keys(properties).forEach(key => {
                if (key === 'type') return;

                const prop = properties[key];
                const isRequired = schema.required && schema.required.includes(key);

                const formGroup = document.createElement('div');
                formGroup.className = 'form-group';

                // Create label
                const label = document.createElement('label');
                label.textContent = formatFieldName(key);
                if (isRequired) {
                    label.innerHTML += ' <span style="color: red;">*</span>';
                }
                if (prop.description) {
                    label.innerHTML += `<span class="label-description">(${prop.description})</span>`;
                }
                formGroup.appendChild(label);

                // Create input based on type
                const input = createInputForType(componentType, key, prop);
                formGroup.appendChild(input);

                container.appendChild(formGroup);
            });
        }

        function createInputForType(componentType, key, prop) {
            const inputId = `${componentType}_${key}`;
            let input;

            // Check if it's a boolean
            if (prop.type === 'boolean') {
                const wrapper = document.createElement('div');
                wrapper.className = 'checkbox-group';

                input = document.createElement('input');
                input.type = 'checkbox';
                input.id = inputId;
                input.checked = prop.default !== undefined ? prop.default : false;

                const label = document.createElement('label');
                label.htmlFor = inputId;
                label.textContent = '–í–∫–ª—é—á–µ–Ω–æ';
                label.style.fontWeight = 'normal';

                wrapper.appendChild(input);
                wrapper.appendChild(label);

                input.addEventListener('change', (e) => {
                    currentParams[componentType][key] = e.target.checked;
                });

                currentParams[componentType][key] = input.checked;
                return wrapper;
            }

            // Check if it's an enum (Literal in Pydantic)
            if (prop.enum) {
                input = document.createElement('select');
                input.id = inputId;

                prop.enum.forEach(value => {
                    const option = document.createElement('option');
                    option.value = value;
                    option.textContent = value;
                    if (value === prop.default) {
                        option.selected = true;
                    }
                    input.appendChild(option);
                });

                input.addEventListener('change', (e) => {
                    currentParams[componentType][key] = e.target.value;
                });

                currentParams[componentType][key] = input.value;
                return input;
            }

            // Number input
            if (prop.type === 'integer' || prop.type === 'number') {
                input = document.createElement('input');
                input.type = 'number';
                input.id = inputId;

                if (prop.minimum !== undefined) input.min = prop.minimum;
                if (prop.maximum !== undefined) input.max = prop.maximum;
                if (prop.default !== undefined) input.value = prop.default;

                input.addEventListener('input', (e) => {
                    const value = prop.type === 'integer' ?
                        parseInt(e.target.value) :
                        parseFloat(e.target.value);
                    currentParams[componentType][key] = isNaN(value) ? null : value;
                });

                currentParams[componentType][key] = input.value ?
                    (prop.type === 'integer' ? parseInt(input.value) : parseFloat(input.value)) :
                    null;
                return input;
            }

            // Text input (default)
            input = document.createElement('input');
            input.type = 'text';
            input.id = inputId;
            if (prop.default !== undefined) {
                input.value = prop.default;
            }

            input.addEventListener('input', (e) => {
                currentParams[componentType][key] = e.target.value;
            });

            currentParams[componentType][key] = input.value;
            return input;
        }

        function formatFieldName(key) {
            // Convert snake_case to Title Case
            return key
                .split('_')
                .map(word => word.charAt(0).toUpperCase() + word.slice(1))
                .join(' ');
        }

        // ==========================================
        // FILE HANDLING
        // ==========================================

        document.getElementById('fileInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const fileInfo = document.getElementById('fileInfo');
                fileInfo.style.display = 'flex';
                fileInfo.innerHTML = `
                    <span>üìÑ ${file.name}</span>
                    <span>${(file.size / 1024 / 1024).toFixed(2)} MB</span>
                `;
            }
        });

        // ==========================================
        // PIPELINE PROCESSING
        // ==========================================

        async function processPipeline() {
            const file = document.getElementById('fileInput').files[0];
            if (!file) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª');
                return;
            }

            // Validate selections
            const loaderType = document.getElementById('loaderType').value;
            const splitterType = document.getElementById('splitterType').value;
            const embeddingType = document.getElementById('embeddingType').value;
            const databaseType = document.getElementById('databaseType').value;

            if (!loaderType || !splitterType || !embeddingType || !databaseType) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–∞–π–ø–ª–∞–π–Ω–∞');
                return;
            }

            const btn = document.getElementById('processBtn');
            btn.disabled = true;

            try {
                // Build config with dynamic parameters
                const config = {
                    name: document.getElementById('pipelineName').value,
                    loader: {
                        type: loaderType,
                        ...currentParams.loader
                    },
                    splitter: {
                        type: splitterType,
                        ...currentParams.splitter
                    },
                    embedding: {
                        type: embeddingType,
                        ...currentParams.embedding
                    },
                    database: {
                        type: databaseType,
                        ...currentParams.database
                    }
                };

                console.log('Pipeline config:', config);

                // Create pipeline
                showStatus('–°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–π–ø–ª–∞–π–Ω–∞...', 'info');
                const pipelineResp = await fetch(`${API_URL}/api/pipelines`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });

                if (!pipelineResp.ok) {
                    const error = await pipelineResp.json();
                    throw new Error(error.detail || '–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–∞–π–ø–ª–∞–π–Ω–∞');
                }

                const pipelineData = await pipelineResp.json();
                const pipelineId = pipelineData.pipeline_id;

                // Upload file
                showStatus('–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞...', 'info');
                const formData = new FormData();
                formData.append('file', file);

                const uploadResp = await fetch(
                    `${API_URL}/api/pipelines/${pipelineId}/process`,
                    { method: 'POST', body: formData }
                );

                if (!uploadResp.ok) {
                    const error = await uploadResp.json();
                    throw new Error(error.detail || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞');
                }

                const uploadData = await uploadResp.json();
                const taskId = uploadData.task_id;

                // Poll for status
                await pollTaskStatus(taskId);

            } catch (error) {
                showStatus(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
                btn.disabled = false;
            }
        }

        async function pollTaskStatus(taskId) {
            const progressContainer = document.getElementById('progressContainer');
            progressContainer.style.display = 'block';

            const interval = setInterval(async () => {
                try {
                    const response = await fetch(`${API_URL}/api/tasks/${taskId}`);
                    const task = await response.json();

                    const progress = (task.progress || 0) * 100;
                    document.getElementById('progressFill').style.width = progress + '%';
                    document.getElementById('progressFill').textContent = Math.round(progress) + '%';

                    showStatus(task.message || '–û–±—Ä–∞–±–æ—Ç–∫–∞...', 'info');

                    if (task.status === 'completed') {
                        clearInterval(interval);
                        showStatus('‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!', 'success');
                        document.getElementById('processBtn').disabled = false;
                        showResults(task);
                    } else if (task.status === 'failed') {
                        clearInterval(interval);
                        showStatus(`‚ùå –û—à–∏–±–∫–∞: ${task.error}`, 'error');
                        document.getElementById('processBtn').disabled = false;
                    }
                } catch (error) {
                    clearInterval(interval);
                    showStatus(`–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞: ${error.message}`, 'error');
                    document.getElementById('processBtn').disabled = false;
                }
            }, 1000);
        }

        function showStatus(message, type) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            statusEl.className = `status-message status-${type}`;
        }

        function showResults(task) {
            const resultsSection = document.getElementById('resultsSection');
            resultsSection.style.display = 'block';

            const statsEl = document.getElementById('stats');
            statsEl.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">‚úì</div>
                    <div class="stat-label">–£—Å–ø–µ—à–Ω–æ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${Math.round((task.progress || 0) * 100)}%</div>
                    <div class="stat-label">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
                </div>
            `;
        }
    </script>
</body>

</html>